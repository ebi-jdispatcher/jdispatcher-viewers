!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=8)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.lineDefaults=e.rectDefaults=e.textDefaults=e.objectDefaults=e.jobIdDefaults=e.ColorSchemeEnum=void 0,function(t){t.fixed="fixed",t.dynamic="dynamic",t.ncbiblast="ncbiblast",t.blasterjs="blasterjs"}(e.ColorSchemeEnum||(e.ColorSchemeEnum={})),e.jobIdDefaults={value:"",required:!0,minLength:35,maxLength:60,pattern:/([a-z_])*-([A-Z0-9])*-\d*-\d*-\d*-(np2|p1m|p2m)$/},e.objectDefaults={selectable:!1,evented:!1,objectCaching:!1},e.textDefaults=Object.assign({},e.objectDefaults),e.rectDefaults=Object.assign({},e.objectDefaults),e.lineDefaults=Object.assign({},e.objectDefaults)},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,a){function o(t){try{c(s.next(t))}catch(t){a(t)}}function r(t){try{c(s.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}c((s=s.apply(t,e||[])).next())}))},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.getDomainURLbyDatabase=e.getUniqueIPRMCDomainDatabases=e.domainDatabaseNameToString=e.getIPRMCDataModelFlatFromXML=e.validateSubmittedDbfetchInput=e.validateSubmittedJobIdInput=e.validateJobId=e.getJdispatcherJsonURL=e.dataAsType=e.fetchData=e.numberToString=e.ObjectCache=e.BasicCanvasRenderer=void 0;const a=i(6),o=i(17),r=n(i(18)),c=i(0);e.BasicCanvasRenderer=class{constructor(t){this.element=t}getFabricCanvas(){const t={defaultCursor:"default",moveCursor:"default",hoverCursor:"default"};this.staticCanvas?this.canvas=new a.fabric.StaticCanvas(this.element,t):this.canvas=new a.fabric.Canvas(this.element,t)}setFrameSize(){this.canvas.setWidth(this.canvasWidth),this.canvas.setHeight(this.canvasHeight)}renderCanvas(){this.canvas.renderAll()}};function h(t){return`https://wwwdev.ebi.ac.uk/Tools/services/rest/${t.split("-")[0]}/result/${t}/jdp?format=json`}function l(t,e=!1){let i=!0;return t.required&&(i=i&&0!==t.value.trim().length),t.minLength&&(i=i&&t.value.trim().length>=t.minLength),t.maxLength&&(i=i&&t.value.trim().length<=t.maxLength),t.pattern&&(i=i&&t.pattern.test(t.value.trim())),e&&(i?console.log(`JobId "${t.value}" is valid!`):console.log(`JobId "${t.value}" is not valid!`)),i}function d(t){let e="Unclassified";return"IPR"===(t=t.toUpperCase())||"INTERPRO"===t?e="InterPro":"CATHGENE3D"===t||"CATH-GENE3D"===t||"GENE3D"===t?e="CATH-Gene3D":"CDD"===t?e="CDD":"PANTHER"===t?e="PANTHER":"HAMAP"===t?e="HAMAP":"PFAM"===t?e="Pfam":"PIRSF"===t?e="PIRSF":"PRINTS"===t?e="PRINTS":"PROSITE PROFILES"===t||"PROSITE_PROFILES"===t||"PROFILE"===t?e="PROSITE profiles":"PROSITE PATTERNS"===t||"PROSITE_PATTERNS"===t||"PROSITE"===t?e="PROSITE patterns":"SFLD"===t?e="SFLD":"SMART"===t?e="SMART":"SUPERFAMILY"===t||"SSF"===t?e="SUPERFAMILY":"TIGERFAMS"===t?e="TIGRFAMs":"PRODOM"===t&&(e="PRODOM"),e}e.ObjectCache=class{constructor(){this.values=new Map}get(t){if(this.values.has(t))return this.values.get(t)}put(t,e){this.values.has(t)||this.values.set(t,e)}delete(t){this.values.has(t)&&this.values.delete(t)}},e.numberToString=function(t){return Number.isInteger(t)?t+".0":t<1e-4||t>1e4?t.toExponential(2):function(t){return Math.floor(t)===t?0:t.toString().split(".")[1].length||0}(t)>3?t.toFixed(3).toString():t.toString()},e.fetchData=function(t,e="json"){return s(this,void 0,void 0,(function*(){return yield r.default(t).then(i=>{if(!i.ok)throw new Error("Could not retrieve data from "+t);if("json"!==e)return i.text();try{return i.json()}catch(e){throw new Error("Could not decode JSON data from "+t)}}).catch(t=>console.log(t))}))},e.dataAsType=function(t,e){return t},e.getJdispatcherJsonURL=h,e.validateJobId=l,e.validateSubmittedJobIdInput=function(t){const e=Object.assign({},c.jobIdDefaults);return e.value=t,e.value.startsWith("http")||e.value.includes("/")||e.value.includes("./")||!l(e)||(t=h(t)),t},e.validateSubmittedDbfetchInput=function(t,e=30){return function(t){return`https://www.ebi.ac.uk/Tools/dbfetch/dbfetch?db=iprmc;id=${t};format=iprmcxml;style=raw`}(function(t,e=30){let i="";for(const s of t.hits.slice(0,e))i+=""===i?""+s.hit_acc:","+s.hit_acc;return i}(t,e))},e.getIPRMCDataModelFlatFromXML=function(t,e=30){return function(t,e){let i=0,s={};for(const n of t.interpromatch[0].protein)if(i++,i<=e){let t=[],e={};for(const i of n.match){let s={};if(void 0!==i.ipr){const n=`${d(i._attributes.dbname)}_${i.ipr[0]._attributes.id}`;t.includes(n)||t.push(n),n in e||(e[n]=[]),s={id:i.ipr[0]._attributes.id,name:i.ipr[0]._attributes.name,dbname:d(i._attributes.dbname),type:i.ipr[0]._attributes.type,altid:i._attributes.id,altname:i._attributes.name,status:i._attributes.status,model:i._attributes.model,evd:i._attributes.evd,start:Number(i.lcn[0]._attributes.start),end:Number(i.lcn[0]._attributes.end),fragments:i.lcn[0]._attributes.fragments,score:i.lcn[0]._attributes.fragments},e[n].push(s)}else{const n=`${d(i._attributes.dbname)}_${i._attributes.id}`;t.includes(n)||t.push(n),n in e||(e[n]=[]),s={id:i._attributes.id,name:i._attributes.name,dbname:d(i._attributes.dbname),status:i._attributes.status,model:i._attributes.model,evd:i._attributes.evd,type:"Unclassified",start:Number(i.lcn[0]._attributes.start),end:Number(i.lcn[0]._attributes.end),fragments:i.lcn[0]._attributes.fragments,score:i.lcn[0]._attributes.fragments},e[n].push(s)}}s[n._attributes.id]={id:n._attributes.id,name:n._attributes.name,length:Number(n._attributes.length),matches:t.sort(),match:e}}return s}(function(t){try{return JSON.parse(o.xml2json(t,{compact:!0,spaces:2,alwaysArray:!0}))}catch(t){return console.log("Cannot parse the resulting Dbfetch response (likely not formatted XML)!"),{}}}(t),e)},e.domainDatabaseNameToString=d,e.getUniqueIPRMCDomainDatabases=function(t,e){const i=[];for(const s of e)for(const e of t[""+s].matches)i.push(e.split("_")[0]);return i.filter((t,e,i)=>i.indexOf(t)===e)},e.getDomainURLbyDatabase=function(t,e){let i="";return t.startsWith("IPR")?i="https://www.ebi.ac.uk/interpro/entry/InterPro/"+t:"CATH-Gene3D"===e?i="https://www.ebi.ac.uk/interpro/entry/cathgene3d/"+t:"CDD"===e?i="https://www.ebi.ac.uk/interpro/entry/cdd/"+t:"PANTHER"===e?i="https://www.ebi.ac.uk/interpro/entry/panther/"+t:"HAMAP"===e?i="https://www.ebi.ac.uk/interpro/entry/hamap/"+t:"Pfam"===e?i="https://www.ebi.ac.uk/interpro/entry/pfam/"+t:"PIRSF"===e?i="https://www.ebi.ac.uk/interpro/entry/pirsf/"+t:"PRINTS"===e?i="https://www.ebi.ac.uk/interpro/entry/prints/"+t:"PROSITE profiles"===e?i="https://www.ebi.ac.uk/interpro/entry/profile/"+t:"PROSITE patterns"===e?i="https://www.ebi.ac.uk/interpro/entry/prosite/"+t:"SFLD"===e?i="https://www.ebi.ac.uk/interpro/entry/sfld/"+t:"SMART"===e?i="https://www.ebi.ac.uk/interpro/entry/smart/"+t:"SUPERFAMILY"===e?i="https://www.ebi.ac.uk/interpro/entry/ssf/"+t:"TIGRFAMs"===e?i="https://www.ebi.ac.uk/interpro/entry/tigrfams/"+t:"PRODOM"===e&&(i="https://www.ebi.ac.uk/interpro/entry/prodom/"+t),i}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.colorNcbiBlastGradient=e.ncbiBlastGradient=e.colorDefaultGradient=e.defaultGradient=void 0,e.defaultGradient={0:[255,64,64],.25:[255,255,64],.5:[64,255,64],.75:[64,255,255],1:[64,64,255],keys:[0,.25,.5,.75,1]},e.colorDefaultGradient=function(t,i,s){t.setGradient("fill",{type:"linear",x1:i,y1:0,x2:s,y2:0,colorStops:{0:`rgb(${e.defaultGradient[0].join(",")})`,.25:`rgb(${e.defaultGradient[.25].join(",")})`,.5:`rgb(${e.defaultGradient[.5].join(",")})`,.75:`rgb(${e.defaultGradient[.75].join(",")})`,1:`rgb(${e.defaultGradient[1].join(",")})`}})},e.ncbiBlastGradient={0:[0,0,0],40:[0,32,233],50:[117,234,76],80:[219,61,233],200:[219,51,36],keys:[0,40,50,80,200]},e.colorNcbiBlastGradient=function(t,i,s){t.setGradient("fill",{type:"linear",x1:i,y1:0,x2:s,y2:0,colorStops:{0:`rgb(${e.ncbiBlastGradient[0].join(",")})`,.199999:`rgb(${e.ncbiBlastGradient[0].join(",")})`,.2:`rgb(${e.ncbiBlastGradient[40].join(",")})`,.399999:`rgb(${e.ncbiBlastGradient[40].join(",")})`,.4:`rgb(${e.ncbiBlastGradient[50].join(",")})`,.599999:`rgb(${e.ncbiBlastGradient[50].join(",")})`,.6:`rgb(${e.ncbiBlastGradient[80].join(",")})`,.799999:`rgb(${e.ncbiBlastGradient[80].join(",")})`,.8:`rgb(${e.ncbiBlastGradient[200].join(",")})`,1:`rgb(${e.ncbiBlastGradient[200].join(",")})`}})}},function(t,e,i){"use strict";function s(t,e,i,s,n){return(i*s-n)/(t+e)}Object.defineProperty(e,"__esModule",{value:!0}),e.getDomainPixelCoords=e.getQuerySubjPixelCoords=e.getPixelCoords=e.getTotalPixels=e.getTextLegendPaddingFactor=void 0,e.getTextLegendPaddingFactor=function(t){let e=0;return 1===t.length?e=2.5:2===t.length?e=10:3===t.length?e=15.5:4===t.length?e=21:5===t.length?e=29:6===t.length?e=35:7===t.length?e=41:8===t.length&&(e=47),e},e.getTotalPixels=s,e.getPixelCoords=function(t,e,i){return[e+i,e+t-i]},e.getQuerySubjPixelCoords=function(t,e,i,n,a,o,r){const c=s(t,e,t,n,a);return[o+r,o+c-r,o+c+a+r,o+c+a+s(t,e,i,n,a)-r]},e.getDomainPixelCoords=function(t,e,i,s,n,a){const o=t+s*(e-t)/i+a;return[o,t+n*(e-t)/i-a-o]}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.colorByDatabaseName=e.HSVtoRGB=e.getGradientSteps=e.getRgbColorFixed=e.getRgbColorGradient=void 0;const s=i(0);function n(t,e,i){let s,n,a,o,r,c=0,h=0,l=0;switch(s=Math.floor(6*t),n=6*t-s,a=i*(1-e),o=i*(1-n*e),r=i*(1-(1-n)*e),s%6){case 0:c=i,h=r,l=a;break;case 1:c=o,h=i,l=a;break;case 2:c=a,h=i,l=r;break;case 3:c=a,h=o,l=i;break;case 4:c=r,h=a,l=i;break;case 5:c=i,h=a,l=o}return[Math.round(255*c),Math.round(255*h),Math.round(255*l)]}e.getRgbColorGradient=function(t,e,i){const s=i.keys;if(s.length!=e.length)throw Error("Color Scheme and Gradient Steps should have matching lengths!");if(t+0===0)return`rgb(${i[s[0]].join(",")})`;{const i=e[0],s=e[1],a=e[2],o=e[3],r=e[4];let c;if(t<s){const e=0===i?Math.log10(Number.MIN_VALUE):Math.log10(i);c=0+(Math.log10(t)-e)/(Math.log10(s)-e)}else c=t<a?1+(Math.log10(t)-Math.log10(s))/(Math.log10(a)-Math.log10(s)):t<o?2+(Math.log10(t)-Math.log10(a))/(Math.log10(o)-Math.log10(a)):t<r?3+(Math.log10(t)-Math.log10(o))/(Math.log10(r)-Math.log10(o)):4;return`rgb(${n(c/6,.75,1).join(",")})`}},e.getRgbColorFixed=function(t,e,i){const s=i.keys;if(s.length!=e.length)throw Error("Color Scheme and Gradient Steps should have matching lengths!");return t+0===0||t<e[1]?`rgb(${i[s[0]].join(",")})`:t>=e[1]&&t<e[2]?`rgb(${i[s[1]].join(",")})`:t>=e[2]&&t<e[3]?`rgb(${i[s[2]].join(",")})`:t>=e[3]&&t<e[4]?`rgb(${i[s[3]].join(",")})`:t>=e[4]?`rgb(${i[s[4]].join(",")})`:"rgb(192,192,192)"},e.getGradientSteps=function(t,e,i,n){let a=[];if(n===s.ColorSchemeEnum.fixed)a=[0,Math.pow(10,-1),Math.pow(10,0),Math.pow(10,1),Math.pow(10,2)];else if(n===s.ColorSchemeEnum.dynamic)if(e<1e-304){const t=-304;a=[0,Math.pow(10,t),Math.pow(10,t/2),Math.pow(10,t/4),Math.pow(10,t/8)]}else if(t<1){const s=Math.log10(e);if(e<=1){let n,o,r;if(0===t&&i>0)n=Math.log10(i)-1;else{const e=Math.log10(t);n=e+(s-e)/2}o=n+(s-n)/2,r=o+(s-o)/2,a=[t,Math.pow(10,n),Math.pow(10,o),Math.pow(10,r),e]}else{const s=Math.log10(i)-Math.log10(e);a=Math.abs(s)<=2?[t,1,(2+e)/3,(2+2*e)/3,e]:Math.abs(s)<=4?[t,Math.pow(10,s/2),1,(e+1)/2,e]:[t,Math.pow(10,s/2),Math.pow(10,s/4),1,e]}}else a=[t,(3*t+e)/4,(t+e)/2,(t+3*e)/4,e];else a=n===s.ColorSchemeEnum.ncbiblast?[0,40,50,80,200]:[0,1e-5,.01,1,100];return a},e.HSVtoRGB=n,e.colorByDatabaseName=function(t){let e;return e="Pfam"==t?"rgb(211,47,47)":"SUPERFAMILY"==t?"rgb(171,71,188)":"SMART"==t?"rgb(106,27,154)":"HAMAP"==t?"rgb(57,73,171)":"PANTHER"==t?"rgb(33,150,243)":"PRODOM"==t?"rgb(0,188,212)":"PROSITE profiles"==t?"rgb(0,150,136)":"CDD"==t?"rgb(76,175,80)":"CATH-Gene3D"==t?"rgb(205,220,57)":"PIRSF"==t?"rgb(255,235,59)":"PRINTS"==t?"rgb(255,193,7)":"TIGRFAMs"==t?"rgb(255,112,67)":"SFLD"==t?"rgb(121,85,72)":"PROSITE patterns"==t?"rgb(55,71,79)":"rgb(128,128,128)",e}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.drawURLInfoTooltip=e.drawDomainInfoTooltips=e.drawDomains=e.drawContentDomainInfoText=e.drawHitTransparentBox=e.drawDomainCheckbox=e.drawProteinFeaturesText=e.drawContentSupressText=e.drawContentTitleText=e.drawCanvasWrapperStroke=e.drawFooterText=e.drawScaleTick4LabelsGroup=e.drawScaleTick5LabelsGroup=e.drawLineAxis6Buckets=e.drawLineAxis5Buckets=e.drawScaleColorGradient=e.drawScaleScoreText=e.drawCheckBoxText=e.drawScaleTypeText=e.drawDomainTooltips=e.drawDomainQueySubject=e.drawScoreText=e.drawHspNoticeText=e.drawContentSequenceInfoText=e.drawNoHitsFoundText=e.drawContentQuerySubjFooterTextGroup=e.drawContentFooterTextGroup=e.drawDomainLineTracks=e.drawLineTracks=e.drawLineTracksQuerySubject=e.drawContentHeaderTextGroup=e.drawHeaderLinkText=e.drawHeaderTextGroup=void 0;const s=i(6),n=i(1),a=i(3),o=i(2),r=i(0),c=i(4);e.drawHeaderTextGroup=function(t,e,i){const n=i,a=Object.assign({},r.textDefaults);a.fontWeight="bold",a.fontSize=e.fontSize+1,a.top=i,a.left=5;const o=t.program,c=t.version,h=new s.fabric.Text(`${o} (version: ${c})`,a);let l=[];for(const e of t.dbs)l.push(e.name);const d=l.join(", ");a.fontWeight="normal",a.fontSize=e.fontSize,i+=15,a.top=i;const u=new s.fabric.Text("Database(s): "+d,a);i+=15,a.top=i;const b=new s.fabric.Text("Sequence: ",a),f=t.query_len;i+=15,a.top=i;const p=new s.fabric.Text("Length: "+f,a),g=t.start;a.top=n,a.left=e.canvasWidth-135;const m=new s.fabric.Text(""+g,a),S=t.end;a.top=n+15;const x=new s.fabric.Text(""+S,a);return new s.fabric.Group([h,u,b,p,m,x],r.objectDefaults)},e.drawHeaderLinkText=function(t,e,i){const n=t.query_def,a=Object.assign({},r.textDefaults);return a.fontFamily="Menlo",a.fontSize=e.fontSize-2,a.evented=!0,a.top=i-15,a.left=57.5,[new s.fabric.Text(""+n,a),a]},e.drawContentHeaderTextGroup=function(t,e,i){const n=Object.assign({},r.textDefaults);n.fontWeight="bold",n.fontSize=e.fontSize+1,n.top=i+2,n.textAlign="center";const o=a.getTotalPixels(t.queryLen,t.subjLen,t.queryLen,e.contentWidth,e.contentScoringWidth),c=a.getTotalPixels(t.queryLen,t.subjLen,t.subjLen,e.contentWidth,e.contentScoringWidth);n.left=t.startQueryPixels;const h=new s.fabric.Text("Sequence Match",n);let l;h.width=o,n.left=t.startEvalPixels,l=e.colorScheme===r.ColorSchemeEnum.ncbiblast?new s.fabric.Text("Bit score",n):new s.fabric.Text("E-value",n),l.width=e.contentScoringWidth,n.left=t.startSubjPixels;const d=new s.fabric.Text("Subject Match",n);return d.width=c,new s.fabric.Group([h,l,d],r.objectDefaults)},e.drawLineTracksQuerySubject=function(t,e,i){const n=Object.assign({},r.lineDefaults);n.top=i,n.stroke="black",n.strokeWidth=e.strokeWidth;const a=[t.startQueryPixels,i,t.endQueryPixels,i];n.left=t.startQueryPixels;const o=new s.fabric.Line(a,n),c=[t.startQueryPixels,i-3,t.startQueryPixels,i+3];n.top=i-2;const h=new s.fabric.Line(c,n),l=[t.endQueryPixels,i-3,t.endQueryPixels,i+3];n.left=t.endQueryPixels;const d=new s.fabric.Line(l,n),u=[t.startSubjPixels,i,t.endSubjPixels,i];n.top=i,n.left=t.startSubjPixels;const b=new s.fabric.Line(u,n),f=[t.startSubjPixels,i-3,t.startSubjPixels,i+3];n.top=i-2;const p=new s.fabric.Line(f,n),g=[t.endSubjPixels,i-3,t.endSubjPixels,i+3];n.left=t.endSubjPixels;const m=new s.fabric.Line(g,n);return new s.fabric.Group([o,b,h,d,p,m],r.objectDefaults)},e.drawLineTracks=function(t,e,i){const n=Object.assign({},r.lineDefaults);n.top=i,n.stroke="black",n.strokeWidth=e.strokeWidth;const a=[t.startPixels,i,t.endPixels,i];n.left=t.startPixels;const o=new s.fabric.Line(a,n),c=[t.startPixels,i-3,t.startPixels,i+3];n.top=i-2;const h=new s.fabric.Line(c,n),l=[t.endPixels,i-3,t.endPixels,i+3];n.left=t.endPixels;const d=new s.fabric.Line(l,n);return new s.fabric.Group([o,h,d],r.objectDefaults)},e.drawDomainLineTracks=function(t,e,i){const n=Object.assign({},r.lineDefaults);n.top=i,n.stroke="black",n.strokeWidth=e.strokeWidth,n.strokeDashArray=e.strokeDashArray;const a=[t.startPixels,i,t.endPixels,i];return n.left=t.startPixels,new s.fabric.Line(a,n)},e.drawContentFooterTextGroup=function(t,e,i){const n=Object.assign({},r.textDefaults);n.fontSize=e.fontSize,n.top=i,n.left=t.startPixels-2.5;const o=new s.fabric.Text(""+t.start,n);let c=a.getTextLegendPaddingFactor(""+t.end);n.left=t.endPixels-c;const h=new s.fabric.Text(""+t.end,n);return new s.fabric.Group([o,h],r.objectDefaults)},e.drawContentQuerySubjFooterTextGroup=function(t,e,i){const n=Object.assign({},r.textDefaults);n.fontSize=e.fontSize,n.top=i,n.left=t.startQueryPixels-2.5;const o=new s.fabric.Text("1",n);let c=a.getTextLegendPaddingFactor(""+t.queryLen);n.left=t.endQueryPixels-c;const h=new s.fabric.Text(""+t.queryLen,n);n.left=t.startSubjPixels-2.5;const l=new s.fabric.Text("1",n);c=a.getTextLegendPaddingFactor(""+t.subjLen),n.left=t.endSubjPixels-c;const d=new s.fabric.Text(""+t.subjLen,n);return new s.fabric.Group([o,h,l,d],r.objectDefaults)},e.drawNoHitsFoundText=function(t,e){const i=Object.assign({},r.textDefaults);return i.fontWeight="bold",i.fontSize=t.fontSize+1,i.top=e,i.left=t.contentWidth/2,i.fill="red",new s.fabric.Text("--------------------No hits found--------------------",i)},e.drawContentSequenceInfoText=function(t,e,i,n){const a=Object.assign({},r.textDefaults);a.fontFamily="Menlo",a.fontSize=i.fontSize-2,a.top=n-2;const o=" ".repeat(t-(e.hit_db.length+e.hit_id.length)),c=new s.fabric.Text(o,a);let h=`${e.hit_db}:${e.hit_id}  ${e.hit_desc}`,l=`${o}${e.hit_db}:${e.hit_id}  ${e.hit_desc}`;return l.length>40&&(h=(l.slice(0,38)+"...").slice(o.length)),a.left=10+6*o.length,a.evented=!0,[c,new s.fabric.Text(h,a),a]},e.drawHspNoticeText=function(t,e,i,n){const a=Object.assign({},r.textDefaults);return a.fontSize=i.fontSize,a.top=n,a.left=i.contentWidth/2,a.fill="red",new s.fabric.Text(`This hit contains ${t} alignments, but only the first ${e} are displayed!`,a)},e.drawScoreText=function(t,e,i,a){const o=Object.assign({},r.textDefaults);let c;return o.fontSize=i.fontSize,o.top=a-15,o.textAlign="center",o.left=t,c=i.colorScheme===r.ColorSchemeEnum.ncbiblast?new s.fabric.Text(n.numberToString(e.hsp_bit_score),o):new s.fabric.Text(n.numberToString(e.hsp_expect),o),c},e.drawDomainQueySubject=function(t,e,i,n,a,o){const c=Object.assign({},r.rectDefaults);c.evented=!0,c.top=a,c.fill=o,c.rx=5,c.ry=5,c.top=a-15,c.left=t,c.width=e,c.height=10;const h=new s.fabric.Rect(c);return c.top=a-15,c.left=i,c.width=n,c.height=10,[h,new s.fabric.Rect(c)]},e.drawDomainTooltips=function(t,e,i,a,o,c,h){const l=Object.assign({},r.textDefaults);let d;l.fontSize=c.fontSize+1,l.textAlign="left",l.originX="top",l.originY="top",l.top=5,d=c.colorScheme===r.ColorSchemeEnum.ncbiblast?`Start: ${i}\nEnd: ${a}\nBit score: ${n.numberToString(o.hsp_bit_score)}`:`Start: ${i}\nEnd: ${a}\nE-value: ${n.numberToString(o.hsp_expect)}`;const u=new s.fabric.Text(d,l),b=Object.assign({},r.rectDefaults);b.fill="white",b.stroke="lightseagreen",b.rx=5,b.ry=5,b.originX="top",b.originY="top",b.width=140,b.height=60,b.opacity=.95;const f=new s.fabric.Rect(b);return new s.fabric.Group([f,u],{selectable:!1,evented:!1,objectCaching:!1,visible:!1,top:h,left:t+e/2})},e.drawScaleTypeText=function(t,e){const i=Object.assign({},r.textDefaults);return i.fontSize=t.fontSize+1,i.fontWeight="bold",i.top=e,i.left=t.scaleLabelWidth,new s.fabric.Text("Scale Type:",i)},e.drawCheckBoxText=function(t,e){const i=Object.assign({},r.textDefaults);i.fontSize=t.fontSize+1,i.top=e,i.left=t.scaleLabelWidth;const n=Object.assign({},r.textDefaults);n.fontSize=t.fontSize+12,n.fill="grey",n.evented=!0,n.top=e-8,n.left=t.scaleLabelWidth;const a=Object.assign({},n),o=Object.assign({},n);let c;c=t.colorScheme===r.ColorSchemeEnum.dynamic?"☒":"☐",t.colorScheme===r.ColorSchemeEnum.dynamic&&(n.fill="black"),n.left+=80;const h=new s.fabric.Text(c,n);i.left+=100;const l=new s.fabric.Text("Dynamic (E-value: min to max)",i);c=t.colorScheme===r.ColorSchemeEnum.fixed?"☒":"☐",t.colorScheme===r.ColorSchemeEnum.fixed&&(a.fill="black"),a.left+=290;const d=new s.fabric.Text(c,a);i.left+=210;const u=new s.fabric.Text("Fixed (E-value: 0.0 to 100.0)",i);c=t.colorScheme===r.ColorSchemeEnum.ncbiblast?"☒":"☐",t.colorScheme===r.ColorSchemeEnum.ncbiblast&&(o.fill="black"),o.left+=480;const b=new s.fabric.Text(c,o);return i.left+=190,[h,l,n,d,u,a,b,new s.fabric.Text("NCBI BLAST+ (Bit score: <40 to ≥200)",i),o]},e.drawScaleScoreText=function(t,e){const i=Object.assign({},r.textDefaults);let n;return i.fontSize=t.fontSize+1,i.top=e,n=t.colorScheme===r.ColorSchemeEnum.ncbiblast?"Bit score":"E-value",t.colorScheme===r.ColorSchemeEnum.ncbiblast?i.left=t.scaleLabelWidth-56:i.left=t.scaleLabelWidth-50,new s.fabric.Text(""+n,i)},e.drawScaleColorGradient=function(t,e){const i=Object.assign({},r.rectDefaults);i.top=e,i.left=t.scaleLabelWidth,i.width=t.scaleWidth,i.height=15;const n=new s.fabric.Rect(i);return t.colorScheme===r.ColorSchemeEnum.ncbiblast?o.colorNcbiBlastGradient(n,0,t.scaleWidth):o.colorDefaultGradient(n,0,t.scaleWidth),n},e.drawLineAxis5Buckets=function(t,e,i,n,a,o,c){const h=Object.assign({},r.lineDefaults);h.top=c,h.stroke="black",h.strokeWidth=o.strokeWidth;const l=[t,c,a,c];h.left=t;const d=new s.fabric.Line(l,h),u=[t,c,t,c+4],b=new s.fabric.Line(u,h),f=[e,c,e,c+4];h.left=e;const p=new s.fabric.Line(f,h),g=[i,c,i,c+4];h.left=i;const m=new s.fabric.Line(g,h),S=[n,c,n,c+4];h.left=n;const x=new s.fabric.Line(S,h),v=[a,c,a,c+4];h.left=a;const w=new s.fabric.Line(v,h);return new s.fabric.Group([d,b,p,m,x,w],r.objectDefaults)},e.drawLineAxis6Buckets=function(t,e,i,n,a,o,c,h){const l=Object.assign({},r.lineDefaults);l.top=h,l.stroke="black",l.strokeWidth=c.strokeWidth;const d=[t,h,o,h];l.left=t;const u=new s.fabric.Line(d,l),b=[t,h,t,h+4],f=new s.fabric.Line(b,l),p=[e,h,e,h+4];l.left=e;const g=new s.fabric.Line(p,l),m=[i,h,i,h+4];l.left=i;const S=new s.fabric.Line(m,l),x=[n,h,n,h+4];l.left=n;const v=new s.fabric.Line(x,l),w=[a,h,a,h+4];l.left=a;const P=new s.fabric.Line(w,l),D=[o,h,o,h+4];l.left=o;const L=new s.fabric.Line(D,l);return new s.fabric.Group([u,f,g,S,v,P,L],r.objectDefaults)},e.drawScaleTick5LabelsGroup=function(t,e,i,n){const a=Object.assign({},r.textDefaults);a.top=n,a.fontSize=i.fontSize;let o="<"+t[1];a.left=i.scaleLabelWidth+e-3*o.length-72;const c=new s.fabric.Text(o,a);o=`${t[1]} - ${t[2]}`,a.left=i.scaleLabelWidth+2*e-3*o.length-72;const h=new s.fabric.Text(o,a);o=`${t[2]} - ${t[3]}`,a.left=i.scaleLabelWidth+3*e-3*o.length-72;const l=new s.fabric.Text(o,a);o=`${t[3]} - ${t[4]}`,a.left=i.scaleLabelWidth+4*e-3*o.length-72;const d=new s.fabric.Text(o,a);o="≥"+t[4],a.left=i.scaleLabelWidth+i.scaleWidth-3*o.length-72;const u=new s.fabric.Text(o,a);return new s.fabric.Group([c,h,l,d,u],r.objectDefaults)},e.drawScaleTick4LabelsGroup=function(t,e,i,a){const o=Object.assign({},r.textDefaults);o.top=a,o.fontSize=i.fontSize,o.left=i.scaleLabelWidth-3*n.numberToString(t[0]).length;const c=new s.fabric.Text(n.numberToString(t[0]),o);o.left=i.scaleLabelWidth+e-3*n.numberToString(t[1]).length;const h=new s.fabric.Text(n.numberToString(t[1]),o);o.left=i.scaleLabelWidth+2*e-3*n.numberToString(t[2]).length;const l=new s.fabric.Text(n.numberToString(t[2]),o);o.left=i.scaleLabelWidth+3*e-3*n.numberToString(t[3]).length;const d=new s.fabric.Text(n.numberToString(t[3]),o);o.left=i.scaleLabelWidth+i.scaleWidth-3*n.numberToString(t[4]).length;const u=new s.fabric.Text(n.numberToString(t[4]),o);return new s.fabric.Group([c,h,l,d,u],r.objectDefaults)},e.drawFooterText=function(t,e){const i=Object.assign({},r.textDefaults);return i.fontSize=t.fontSize,i.evented=!0,i.top=e,i.left=225,[new s.fabric.Text("European Bioinformatics Institute 2006-2020. EBI is an Outstation of the European Molecular Biology Laboratory.",i),i]},e.drawCanvasWrapperStroke=function(t){return new s.fabric.Rect({selectable:!1,evented:!1,objectCaching:!1,top:0,left:0,width:t.canvasWidth-1,height:t.canvasHeight-1,strokeWidth:1,stroke:"lightseagreen",fill:"transparent"})},e.drawContentTitleText=function(t,e){const i=Object.assign({},r.textDefaults);return i.fontWeight="bold",i.fontSize=t.fontSize+2,i.top=e,i.left=350,new s.fabric.Text("Fast Family and Domain Prediction by InterPro",i)},e.drawContentSupressText=function(t,e,i){const n=Object.assign({},r.textDefaults);n.fontSize=t.fontSize,n.top=e,n.left=t.contentWidth/2,n.fill="red";const a=`This is a partial representation of the result, only the first ${i} hits are displayed!`;return new s.fabric.Text(""+a,n)},e.drawProteinFeaturesText=function(t,e){const i=Object.assign({},r.textDefaults);return i.fontSize=t.fontSize+1,i.fontWeight="bold",i.top=e,i.left=t.scaleLabelWidth-10,new s.fabric.Text("Select your database:",i)},e.drawDomainCheckbox=function(t,e,i,n){const a=Object.assign({},r.rectDefaults);a.top=e,a.left=i,a.height=15,a.width=15,a.evented=!0;const o=Object.assign({},r.textDefaults);return o.fontSize=t.fontSize+1,o.top=e,o.left=i+20,t.currentDisabled?(o.fill="grey",a.fill="white",a.stroke="grey"):void 0!==t.currentDomainDatabase?(a.fill=c.colorByDatabaseName(t.currentDomainDatabase),a.stroke="black"):(a.fill="white",a.stroke="grey"),[new s.fabric.Rect(a),new s.fabric.Text(n,o),a,a]},e.drawHitTransparentBox=function(t,e,i,n,a){const o=Object.assign({},r.rectDefaults);return o.fill=n,o.opacity=.5,o.rx=5,o.ry=5,o.top=i+15,o.left=t,o.width=e,o.height=a,new s.fabric.Rect(o)},e.drawContentDomainInfoText=function(t,e,i){const n=Object.assign({},r.textDefaults);n.fontFamily="Menlo",n.fontSize=e.fontSize-2,n.top=i-5;const a=" ".repeat(40-t.length),o=new s.fabric.Text(a,n);let c=""+t,h=`${a}${t}`;return h.length>40&&(c=(h.slice(0,38)+"...").slice(a.length)),n.left=12+6*a.length,n.evented=!0,[o,new s.fabric.Text(c,n),n]},e.drawDomains=function(t,e,i,n){const a=Object.assign({},r.rectDefaults);return a.evented=!0,a.top=i,a.fill=n,a.rx=5,a.ry=5,a.top=i-15,a.left=t,a.width=e,a.height=10,a.stroke="black",a.strokeWidth=.5,new s.fabric.Rect(a)},e.drawDomainInfoTooltips=function(t,e,i,n,a,o,c){const h=Object.assign({},r.textDefaults);h.fontSize=o.fontSize+1,h.textAlign="left",h.originX="top",h.originY="top",h.top=5,h.left=10,h.width=200;let l=`Start: ${i}\nEnd: ${n}\nDatabase: ${a.dbname}\n`;void 0!==a.altid&&void 0!==a.altname?l+=`ID: ${a.altid}\nName: ${a.altname}\nType: ${a.type}\nIPR ID: ${a.id}\nIPR Name: ${a.name}\n`:l+=`ID: ${a.id}\nName: ${a.name}\nType: ${a.type}\n`;const d=new s.fabric.Textbox(l,h),u=Object.assign({},r.rectDefaults);u.fill="white",u.stroke="lightseagreen",u.rx=5,u.ry=5,u.originX="top",u.originY="top",u.width=d.width+40,u.height=d.height,u.opacity=.95;const b=new s.fabric.Rect(u);return new s.fabric.Group([b,d],{selectable:!1,evented:!1,objectCaching:!1,visible:!1,top:c,left:t+e/2})},e.drawURLInfoTooltip=function(t,e,i,n,a){const o=Object.assign({},r.textDefaults);let c;if(o.fontSize=n.fontSize+1,o.originX="left",o.originY="top",o.top=5,o.left=5,e.length>150&&(e=e.slice(0,150)+"..."),""!==e){const t=6.3*e.length,n=6.3*i.length;o.width=t>n?t+5:n+5,c=new s.fabric.Text(e+"\n"+i,o)}else{const t=6.3*i.length;o.width=t+5,c=new s.fabric.Text(""+i,o)}const h=Object.assign({},r.rectDefaults);h.fill="white",h.stroke="lightseagreen",h.strokeWidth=.5,h.rx=5,h.ry=5,h.originX="left",h.originY="top",h.width=c.width+10,h.height=c.height+10,h.opacity=.95;const l=new s.fabric.Rect(h),d=new s.fabric.Group([l,c],{selectable:!1,evented:!1,objectCaching:!1,visible:!0,top:a,originX:"left"});return d.left=t+10,d}},function(t,e){t.exports=require("fabric")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.mouseOutDomainCheckbox=e.mouseDownDomainCheckbox=e.mouseOverDomainCheckbox=e.mouseOutCheckbox=e.mouseDownCheckbox=e.mouseOverCheckbox=e.mouseOutDomain=e.mouseOverDomain=e.mouseOutText=e.mouseDownText=e.mouseOverText=void 0;const s=i(5);e.mouseOverText=function(t,e,i,n,a,o){t.on("mouseover",r=>{if(r.target){r.target.set("hoverCursor","pointer"),r.target.setOptions(e),r.target.setOptions({underline:!0});const c=s.drawURLInfoTooltip(+t.left,i,n,a,+t.top+15);o.canvas.add(c),o.canvas.renderAll(),c.visible=!1}})},e.mouseDownText=function(t,e,i){t.on("mousedown",t=>{t.target&&(window.open(e,"_blank"),i.canvas.renderAll())})},e.mouseOutText=function(t,e,i){t.on("mouseout",t=>{t.target&&(t.target.setOptions(e),t.target.setOptions({underline:!1}),i.canvas.renderAll())})},e.mouseOverDomain=function(t,e,i,n,a,o,r,c){t.on("mouseover",h=>{if(h.target){let l;h.target.set("hoverCursor","pointer"),l="hsp_hit_from"in o?s.drawDomainTooltips(e,i,n,a,o,r,t.top+5):s.drawDomainInfoTooltips(e,i,n,a,o,r,t.top+5),c.canvas.add(l),l.set({visible:!0}),t.bringToFront(),l.bringToFront(),c.canvas.renderAll(),l.set({visible:!1})}})},e.mouseOutDomain=function(t,e){t.on("mouseout",t=>{t.target&&e.canvas.renderAll()})},e.mouseOverCheckbox=function(t,e,i){t.on("mouseover",t=>{t.target&&(t.target.set("hoverCursor","pointer"),t.target.setOptions(e),t.target.setOptions({fill:"black"}),i.canvas.renderAll())})},e.mouseDownCheckbox=function(t,e,i){t.on("mousedown",t=>{t.target&&i.colorScheme!=e&&(i.colorScheme=e,i.render())})},e.mouseOutCheckbox=function(t,e,i,s){t.on("mouseout",t=>{t.target&&(t.target.setOptions(e),s.colorScheme!=i&&t.target.setOptions({fill:"grey"}),s.canvas.renderAll())})},e.mouseOverDomainCheckbox=function(t,e,i,s){t.on("mouseover",t=>{if(t.target){t.target.set("hoverCursor","pointer"),t.target.setOptions(e);let n=!1;s.uniqueDomainDatabases.includes(i)||(n=!0),n?(t.target.setOptions({fill:"white",stroke:"grey"}),t.target.set("hoverCursor","default")):s.domainDatabaseList.includes(i)?(t.target.setOptions({opacity:.5,stroke:"grey"}),t.target.set("hoverCursor","pointer")):(t.target.setOptions({stroke:"black"}),t.target.set("hoverCursor","pointer")),s.canvas.renderAll()}})},e.mouseDownDomainCheckbox=function(t,e,i){t.on("mousedown",t=>{if(t.target)if(!i.domainDatabaseList.includes(e)&&i.uniqueDomainDatabases.includes(e))i.domainDatabaseList.push(e),i.currentDomainDatabase=e,i.render();else if(i.uniqueDomainDatabases.includes(e)){const t=i.domainDatabaseList.indexOf(e);t>-1&&i.domainDatabaseList.splice(t,1),i.currentDomainDatabase=void 0,i.render()}})},e.mouseOutDomainCheckbox=function(t,e,i,s){t.on("mouseout",t=>{if(t.target){let n=!1;s.uniqueDomainDatabases.includes(i)||(n=!0),s.domainDatabaseList.includes(i)?n?t.target.setOptions({stroke:"grey",fill:"white"}):(t.target.setOptions(e),t.target.setOptions({opacity:1,stroke:"black"})):t.target.setOptions({stroke:"grey",fill:"white"}),s.canvas.renderAll()}})}},function(t,e,i){"use strict";var s=this&&this.__createBinding||(Object.create?function(t,e,i,s){void 0===s&&(s=i),Object.defineProperty(t,s,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,s){void 0===s&&(s=i),t[s]=e[i]}),n=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),a=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.hasOwnProperty.call(t,i)&&s(e,t,i);return n(e,t),e},o=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,a){function o(t){try{c(s.next(t))}catch(t){a(t)}}function r(t){try{c(s.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}c((s=s.apply(t,e||[])).next())}))},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const c=r(i(9)),h=r(i(10)),l=r(i(11)),d=i(12),u=i(13),b=a(i(14)),f=a(i(15)),p=i(16),g=i(19),m=i(0),S=i(1);function x(t,e){return o(this,void 0,void 0,(function*(){const i=u.promisify(b.writeFile);return fetch(t).then(t=>t.arrayBuffer()).then(t=>i(e,Buffer.from(t))).catch(t=>{console.log(t),process.exit()})}))}function v(t,e){return"json"===e?JSON.parse(b.readFileSync(t,"utf8")):b.readFileSync(t,"utf8")}c.default(),d.program.version("0.0.1").description("Generate Static Images with jdispatcher-viewers-cli").option("-vo, --visout","generate Visual Output").option("-fp, --funcpred","generate Functional Predictions").option("-i, --in <data>","jobID or URL/URI path to JSON (for VO and FP)").option("-ix, --inx <xml>","URL/URI path to XML (for FP)").option("-o, --out <file>","file name used for output").option("-of, --outformat <format>","output format [png]").option("-v, --verbose","Verbose [false]").action((function(){return o(this,void 0,void 0,(function*(){if(process.argv.slice(2).length){let t,e,i,s,n;if(d.program.verbose&&(console.log("Running jdispatcher-viewers-cli..."),console.log("Your options were:"),console.log(process.argv)),d.program.visout||d.program.funcpred||(console.log("'--funcpred' or '--visout' is required!"),process.exit()),(d.program.visout||d.program.funcpred)&&(d.program.in||(console.log("Input data required!"),process.exit()),d.program.out||(console.log("Output file required!"),process.exit())),"mock_jobid-I20200317-103136-0485-5599422-np2"===d.program.in)t=f.join(process.cwd(),"./src/testdata/ncbiblast.json");else{const e=S.validateSubmittedJobIdInput(d.program.in);e.startsWith("http")?(t=f.join(process.cwd(),d.program.in+".json"),yield x(e,t),console.log(e),console.log(t)):t=f.isAbsolute(d.program.in)?d.program.in:f.join(process.cwd(),d.program.in)}if(b.existsSync(t)?(e=v(t,"json"),i=S.dataAsType(e,"SSSResultModel")):(console.log("JobID provided is not valid, or file not readable!"),process.exit()),void 0===i&&(console.log("Failed to get the SSS JSON data!"),process.exit()),d.program.visout){d.program.verbose&&console.log("Generating Visual Output...");let t={colorScheme:m.ColorSchemeEnum.dynamic,numberHits:100,numberHsps:10,logSkippedHsps:!0,canvasWrapperStroke:!0,staticCanvas:!0};s=new p.VisualOutput("canvas",i,t),s.render()}else if(d.program.funcpred){let e,n,a,o;if(d.program.verbose&&console.log("Generating Functional Predictions..."),"mock_jobid-I20200317-103136-0485-5599422-np2"===d.program.in)e=f.join(process.cwd(),"./src/testdata/iprmc.xml");else if(d.program.inx)e=f.isAbsolute(d.program.in)?d.program.inx:f.join(process.cwd(),d.program.inx);else{const t=S.validateSubmittedDbfetchInput(i);e=f.join(process.cwd(),d.program.in+".xml"),yield x(t,e)}b.existsSync(t)?(n=v(e,"xml"),a=S.getIPRMCDataModelFlatFromXML(n),o=S.dataAsType(a,"IPRMCResultModelFlat")):(console.log("XML file not readable!"),process.exit()),void 0===i&&(console.log("Failed to get the Dbfetch XML data!"),process.exit());let r={colorScheme:m.ColorSchemeEnum.dynamic,numberHits:30,canvasWrapperStroke:!0,staticCanvas:!0};s=new g.FunctionalPredictions("canvas",i,o,r),s.render()}d.program.verbose&&console.log(`Generating ${d.program.outformat.toUpperCase()} output...`),n=f.isAbsolute(d.program.out)?d.program.out:f.join(process.cwd(),d.program.out),"png"===d.program.outformat.toString().toLowerCase()?b.writeFileSync(n,s.canvas.toDataURL().replace("data:image/png;base64,",""),"base64"):"svg"===d.program.outformat.toString().toLowerCase()&&b.writeFileSync(n,s.canvas.toSVG().toString())}else console.log(h.default.green(l.default.textSync("jd-viewers-cli",{horizontalLayout:"default"}))),console.log(""),d.program.outputHelp()}))})).parseAsync(process.argv)},function(t,e){t.exports=require("clear")},function(t,e){t.exports=require("chalk")},function(t,e){t.exports=require("figlet")},function(t,e){t.exports=require("commander")},function(t,e){t.exports=require("util")},function(t,e){t.exports=require("fs")},function(t,e){t.exports=require("path")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VisualOutput=void 0;const s=i(2),n=i(3),a=i(4),o=i(1),r=i(0),c=i(7),h=i(5);let l=new o.ObjectCache;class d extends o.BasicCanvasRenderer{constructor(t,e,i){super(t),this.dataObj=e,this.topPadding=0,this.queryLen=0,this.subjLen=0,this.gradientSteps=[],this.queryFactor=1,this.subjFactor=1,null!=i.canvasWidth?this.canvasWidth=i.canvasWidth:this.canvasWidth=1e3,null!=i.canvasHeight?this.canvasHeight=i.canvasHeight:this.canvasHeight=110,null!=i.contentWidth?this.contentWidth=i.contentWidth:this.contentWidth=65.5*this.canvasWidth/100,null!=i.contentScoringWidth?this.contentScoringWidth=i.contentScoringWidth:this.contentScoringWidth=7*this.canvasWidth/100,null!=i.contentLabelWidth?this.contentLabelWidth=i.contentLabelWidth:this.contentLabelWidth=26.5*this.canvasWidth/100,null!=i.scaleWidth?this.scaleWidth=i.scaleWidth:this.scaleWidth=75*this.canvasWidth/100,null!=i.scaleLabelWidth?this.scaleLabelWidth=i.scaleLabelWidth:this.scaleLabelWidth=20*this.canvasWidth/100,null!=i.marginWidth?this.marginWidth=i.marginWidth:this.marginWidth=.15*this.canvasWidth/100,null!=i.colorScheme?this.colorScheme=i.colorScheme:this.colorScheme=r.ColorSchemeEnum.dynamic,null!=i.numberHits?this.numberHits=i.numberHits:this.numberHits=100,null!=i.numberHsps?this.numberHsps=i.numberHsps:this.numberHsps=10,null!=i.logSkippedHsps?this.logSkippedHsps=i.logSkippedHsps:this.logSkippedHsps=!0,null!=i.fontSize?this.fontSize=i.fontSize:this.fontSize=12,null!=i.fontWeigth?this.fontWeigth=i.fontWeigth:this.fontWeigth="normal",null!=i.fontFamily?this.fontFamily=i.fontFamily:this.fontFamily="Times New Roman",null!=i.canvasWrapperStroke?this.canvasWrapperStroke=i.canvasWrapperStroke:this.canvasWrapperStroke=!1,null!=i.staticCanvas?this.staticCanvas=i.staticCanvas:this.staticCanvas=!1,this.getFabricCanvas()}render(){this.loadInitalProperties(),this.loadInitialCoords(),this.canvas.clear(),this.drawHeaderGroup(),this.drawContentGroup(),this.drawFooterGroup(),this.wrapCanvas(),this.setFrameSize(),this.renderCanvas()}loadInitalProperties(){this.queryLen=this.dataObj.query_len;for(const t of this.dataObj.hits.slice(0,this.numberHits))t.hit_len>this.subjLen&&(this.subjLen=t.hit_len);const t=this.queryLen/this.subjLen,e=this.subjLen/this.queryLen;t>8&&(this.subjFactor=.5*this.queryLen/this.subjLen),e>8&&(this.queryFactor=.5*this.subjLen/this.queryLen)}loadInitialCoords(){this.startQueryPixels=l.get("startQueryPixels"),this.endQueryPixels=l.get("endQueryPixels"),this.startSubjPixels=l.get("startSubjPixels"),this.endSubjPixels=l.get("endSubjPixels"),this.startEvalPixels=l.get("startEvalPixels"),this.startQueryPixels||this.endQueryPixels||this.startSubjPixels||this.endSubjPixels||this.startEvalPixels||([this.startQueryPixels,this.endQueryPixels,this.startSubjPixels,this.endSubjPixels]=n.getQuerySubjPixelCoords(this.queryLen*this.queryFactor,this.subjLen*this.subjFactor,this.subjLen*this.subjFactor,this.contentWidth,this.contentScoringWidth,this.contentLabelWidth,this.marginWidth),this.startEvalPixels=this.endQueryPixels+2*this.marginWidth,l.put("startQueryPixels",this.startQueryPixels),l.put("endQueryPixels",this.endQueryPixels),l.put("startSubjPixels",this.startSubjPixels),l.put("endSubjPixels",this.endSubjPixels),l.put("startEvalPixels",this.startEvalPixels))}drawHeaderGroup(){let t,e,i;this.topPadding=2,t=l.get("textHeaderGroup"),t||(t=h.drawHeaderTextGroup(this.dataObj,{fontSize:this.fontSize,canvasWidth:this.canvasWidth},this.topPadding),l.put("textHeaderGroup",t)),this.canvas.add(t),this.topPadding+=45,e=l.get("textHeaderLink"),i=l.get("textHeaderLink_textSeqObj"),e||([e,i]=h.drawHeaderLinkText(this.dataObj,{fontSize:this.fontSize},this.topPadding),l.put("textHeaderLink",e),l.put("textHeaderLink_textSeqObj",i)),this.canvas.add(e),this.staticCanvas||null!==this.dataObj.query_url&&""!==this.dataObj.query_url&&(c.mouseOverText(e,i,this.dataObj.query_def,this.dataObj.query_url,{fontSize:this.fontSize},this),c.mouseDownText(e,this.dataObj.query_url,this),c.mouseOutText(e,i,this))}drawContentGroup(){if(this.dataObj.hits.length>0){let t,e,i;this.topPadding+=25,t=l.get("textContentHeaderGroup"),t||(t=h.drawContentHeaderTextGroup({queryLen:this.queryLen*this.queryFactor,subjLen:this.subjLen*this.subjFactor,startQueryPixels:this.startQueryPixels,startEvalPixels:this.startEvalPixels,startSubjPixels:this.startSubjPixels},{contentWidth:this.contentWidth,contentScoringWidth:this.contentScoringWidth,fontSize:this.fontSize,colorScheme:this.colorScheme},this.topPadding),l.put("textContentHeaderGroup",t)),this.canvas.add(t),this.topPadding+=20,e=l.get("lineTrackGroup"),e||(e=h.drawLineTracksQuerySubject({startQueryPixels:this.startQueryPixels,endQueryPixels:this.endQueryPixels,startSubjPixels:this.startSubjPixels,endSubjPixels:this.endSubjPixels},{strokeWidth:2},this.topPadding),l.put("lineTrackGroup",e)),this.canvas.add(e),this.topPadding+=5,i=l.get("textContentFooterGroup"),i||(i=h.drawContentQuerySubjFooterTextGroup({queryLen:this.queryLen,subjLen:this.subjLen,startQueryPixels:this.startQueryPixels,endQueryPixels:this.endQueryPixels,startSubjPixels:this.startSubjPixels,endSubjPixels:this.endSubjPixels},{fontSize:this.fontSize},this.topPadding),l.put("textContentFooterGroup",i)),this.canvas.add(i),this.topPadding+=25,this.drawDynamicContentGroup(),this.topPadding+=20,this.drawColorScaleGroup()}else{this.topPadding+=20;const t=h.drawNoHitsFoundText({fontSize:this.fontSize,contentWidth:this.contentWidth},this.topPadding);this.canvas.add(t)}}drawDynamicContentGroup(){let t=0,e=0;for(const i of this.dataObj.hits.slice(0,this.numberHits))i.hit_len>t&&(t=i.hit_len),i.hit_db.length+i.hit_id.length>e&&(e=i.hit_db.length+i.hit_id.length);let i=Number.MAX_VALUE,o=0,d=Number.MAX_VALUE;for(const t of this.dataObj.hits.slice(0,this.numberHits))for(const e of t.hit_hsps)this.colorScheme===r.ColorSchemeEnum.ncbiblast?(e.hsp_bit_score<i&&(i=e.hsp_bit_score),e.hsp_bit_score>o&&(o=e.hsp_bit_score),e.hsp_bit_score<d&&e.hsp_bit_score>0&&(d=e.hsp_bit_score)):(e.hsp_expect<i&&(i=e.hsp_expect),e.hsp_expect>o&&(o=e.hsp_expect),e.hsp_expect<d&&e.hsp_expect>0&&(d=e.hsp_expect));this.colorScheme,r.ColorSchemeEnum.ncbiblast,this.gradientSteps=a.getGradientSteps(i,o,d,this.colorScheme);let u=0;for(const t of this.dataObj.hits){if(u++,!(u<=this.numberHits)){let t;this.topPadding+=20,t=l.get("supressText"),t||(t=h.drawContentSupressText({fontSize:this.fontSize,contentWidth:this.contentWidth},this.topPadding,this.numberHits),l.put("supressText",t)),t.top=this.topPadding,this.canvas.add(t),this.topPadding+=20;break}{let i=0;const o=t.hit_hsps.length;let d,u,b;[u,b,d]=h.drawContentSequenceInfoText(e,t,{fontSize:this.fontSize},this.topPadding),this.canvas.add(u),this.canvas.add(b),this.staticCanvas||(c.mouseOverText(b,d,t.hit_def,t.hit_url,{fontSize:this.fontSize},this),c.mouseDownText(b,t.hit_url,this),c.mouseOutText(b,d,this));for(const e of t.hit_hsps){if(i++,!(i<=this.numberHsps)){if(!0===this.logSkippedHsps){let t;t=l.get("hspTextNotice"),t||(t=h.drawHspNoticeText(o,this.numberHsps,{fontSize:this.fontSize,contentWidth:this.contentWidth},this.topPadding),l.put("hspTextNotice",t)),this.canvas.add(t),this.topPadding+=20}break}{const i=t.hit_len;let o,l,d,u;[o,l,d,u]=n.getQuerySubjPixelCoords(this.queryLen*this.queryFactor,this.subjLen*this.subjFactor,i,this.contentWidth,this.contentScoringWidth,this.contentLabelWidth,this.marginWidth),this.topPadding+=5;const b=h.drawLineTracksQuerySubject({startQueryPixels:o,endQueryPixels:l,startSubjPixels:d,endSubjPixels:u},{strokeWidth:1},this.topPadding);let f,p,g,m,S,x,v,w,P,D,L;this.canvas.add(b),"-1"===e.hsp_query_frame?(S=e.hsp_query_to,x=e.hsp_query_from):(S=e.hsp_query_from,x=e.hsp_query_to),"-1"===e.hsp_hit_frame?(v=e.hsp_hit_to,w=e.hsp_hit_from):(v=e.hsp_hit_from,w=e.hsp_hit_to),[f,p]=n.getDomainPixelCoords(o,l,this.queryLen,S,x,this.marginWidth),[g,m]=n.getDomainPixelCoords(d,u,i,v,w,this.marginWidth),P=this.colorScheme===r.ColorSchemeEnum.ncbiblast?a.getRgbColorFixed(e.hsp_bit_score,this.gradientSteps,s.ncbiBlastGradient):a.getRgbColorGradient(e.hsp_expect,this.gradientSteps,s.defaultGradient),this.topPadding+=10,[D,L]=h.drawDomainQueySubject(f,p,g,m,this.topPadding,P),this.canvas.add(D),this.canvas.add(L);const T=h.drawScoreText(this.startEvalPixels,e,{fontSize:this.fontSize,colorScheme:this.colorScheme},this.topPadding);T.width=this.contentScoringWidth,this.canvas.add(T),this.staticCanvas||(c.mouseOverDomain(D,f,p,S,x,e,{fontSize:this.fontSize,colorScheme:this.colorScheme},this),c.mouseOutDomain(D,this),c.mouseOverDomain(L,g,m,v,w,e,{fontSize:this.fontSize,colorScheme:this.colorScheme},this),c.mouseOutDomain(L,this))}}}}}drawColorScaleGroup(){const t=h.drawScaleTypeText({fontSize:this.fontSize,scaleLabelWidth:this.scaleLabelWidth},this.topPadding);let e,i,s,n,a,o,l,d,u;this.canvas.add(t),[n,a,e,o,l,i,d,u,s]=h.drawCheckBoxText({colorScheme:this.colorScheme,fontSize:this.fontSize,scaleLabelWidth:this.scaleLabelWidth},this.topPadding),this.canvas.add(n),this.canvas.add(a),this.staticCanvas||(c.mouseOverCheckbox(n,e,this),c.mouseOutCheckbox(n,e,r.ColorSchemeEnum.dynamic,this),c.mouseDownCheckbox(n,r.ColorSchemeEnum.dynamic,this)),this.canvas.add(o),this.canvas.add(l),this.staticCanvas||(c.mouseOverCheckbox(o,i,this),c.mouseOutCheckbox(o,i,r.ColorSchemeEnum.fixed,this),c.mouseDownCheckbox(o,r.ColorSchemeEnum.fixed,this)),this.canvas.add(d),this.canvas.add(u),this.staticCanvas||(c.mouseOverCheckbox(d,s,this),c.mouseOutCheckbox(d,s,r.ColorSchemeEnum.ncbiblast,this),c.mouseDownCheckbox(d,r.ColorSchemeEnum.ncbiblast,this)),this.topPadding+=25;const b=h.drawScaleScoreText({fontSize:this.fontSize,scaleLabelWidth:this.scaleLabelWidth,colorScheme:this.colorScheme},this.topPadding);this.canvas.add(b);const f=h.drawScaleColorGradient({scaleWidth:this.scaleWidth,scaleLabelWidth:this.scaleLabelWidth,colorScheme:this.colorScheme},this.topPadding);if(this.canvas.add(f),this.colorScheme===r.ColorSchemeEnum.ncbiblast){const t=(this.scaleLabelWidth+this.scaleWidth-this.scaleLabelWidth)/5;this.topPadding+=15;const e=h.drawLineAxis6Buckets(this.scaleLabelWidth,this.scaleLabelWidth+t,this.scaleLabelWidth+2*t,this.scaleLabelWidth+3*t,this.scaleLabelWidth+4*t,this.scaleLabelWidth+this.scaleWidth,{strokeWidth:1},this.topPadding);this.canvas.add(e),this.topPadding+=5;const i=h.drawScaleTick5LabelsGroup(this.gradientSteps,t,{fontSize:this.fontSize,scaleWidth:this.scaleWidth,scaleLabelWidth:this.scaleLabelWidth},this.topPadding);this.canvas.add(i)}else{const t=(this.scaleLabelWidth+this.scaleWidth-this.scaleLabelWidth)/4;this.topPadding+=15;const e=h.drawLineAxis5Buckets(this.scaleLabelWidth,this.scaleLabelWidth+t,this.scaleLabelWidth+2*t,this.scaleLabelWidth+3*t,this.scaleLabelWidth+this.scaleWidth,{strokeWidth:1},this.topPadding);this.canvas.add(e),this.topPadding+=5;const i=h.drawScaleTick4LabelsGroup(this.gradientSteps,t,{fontSize:this.fontSize,scaleWidth:this.scaleWidth,scaleLabelWidth:this.scaleLabelWidth},this.topPadding);this.canvas.add(i)}}drawFooterGroup(){let t,e;this.topPadding+=30,t=l.get("copyrightText"),e=l.get("copyrightText_textFooterObj"),t||e||([t,e]=h.drawFooterText({fontSize:this.fontSize},this.topPadding),l.put("copyrightText",t),l.put("copyrightText_textFooterObj",e)),this.canvas.add(t)}wrapCanvas(){if(this.topPadding+=20,this.canvasHeight=this.topPadding,this.canvasWrapperStroke){const t=h.drawCanvasWrapperStroke({canvasWidth:this.canvasWidth,canvasHeight:this.canvasHeight});this.canvas.add(t)}}}e.VisualOutput=d},function(t,e){t.exports=require("xml-js")},function(t,e){t.exports=require("node-fetch")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FunctionalPredictions=void 0;const s=i(3),n=i(4),a=i(2),o=i(1),r=i(0),c=i(7),h=i(5),l=["PRODOM","CATH-Gene3D","CDD","PANTHER","HAMAP","Pfam","PIRSF","PRINTS","PROSITE profiles","PROSITE patterns","SFLD","SMART","SUPERFAMILY","TIGRFAMs"];function d(t,e,i,s,n,a){let o,r,l,d;t.domainDatabaseList.includes(e)?t.currentDomainDatabase=e:t.currentDomainDatabase=void 0,t.currentDomainDatabaseDisabled=!1,i.includes(e)||(t.currentDomainDatabaseDisabled=!0),[l,d,o,r]=h.drawDomainCheckbox({currentDomainDatabase:t.currentDomainDatabase,currentDisabled:t.currentDomainDatabaseDisabled,fontSize:a.fontSize},s,n,e),t.canvas.add(l),t.canvas.add(d),a.staticCanvas||(c.mouseOverDomainCheckbox(l,o,e,t),c.mouseOutDomainCheckbox(l,o,e,t),c.mouseDownDomainCheckbox(l,e,t))}let u=new o.ObjectCache;class b extends o.BasicCanvasRenderer{constructor(t,e,i,s,n=l){super(t),this.sssDataObj=e,this.iprmcDataObj=i,this.domainDatabaseList=n,this.topPadding=0,this.queryStart=0,this.queryEnd=0,this.gradientSteps=[],this.uniqueDomainDatabases=[],this.currentDomainDatabaseDisabled=!1,null!=s.canvasWidth?this.canvasWidth=s.canvasWidth:this.canvasWidth=1e3,null!=s.canvasHeight?this.canvasHeight=s.canvasHeight:this.canvasHeight=110,null!=s.contentWidth?this.contentWidth=s.contentWidth:this.contentWidth=72.5*this.canvasWidth/100,null!=s.contentLabelWidth?this.contentLabelWidth=s.contentLabelWidth:this.contentLabelWidth=26.5*this.canvasWidth/100,null!=s.contentLabelLeftWidth?this.contentLabelLeftWidth=s.contentLabelLeftWidth:this.contentLabelLeftWidth=8.25*this.canvasWidth/100,null!=s.scaleWidth?this.scaleWidth=s.scaleWidth:this.scaleWidth=75*this.canvasWidth/100,null!=s.scaleLabelWidth?this.scaleLabelWidth=s.scaleLabelWidth:this.scaleLabelWidth=20*this.canvasWidth/100,null!=s.marginWidth?this.marginWidth=s.marginWidth:this.marginWidth=.15*this.canvasWidth/100,null!=s.colorScheme?this.colorScheme=s.colorScheme:this.colorScheme=r.ColorSchemeEnum.dynamic,null!=s.numberHits?this.numberHits=s.numberHits:this.numberHits=30,null!=s.fontSize?this.fontSize=s.fontSize:this.fontSize=12,null!=s.fontWeigth?this.fontWeigth=s.fontWeigth:this.fontWeigth="normal",null!=s.fontFamily?this.fontFamily=s.fontFamily:this.fontFamily="Times New Roman",null!=s.canvasWrapperStroke?this.canvasWrapperStroke=s.canvasWrapperStroke:this.canvasWrapperStroke=!1,null!=s.staticCanvas?this.staticCanvas=s.staticCanvas:this.staticCanvas=!1,this.getFabricCanvas()}render(){this.loadIPRMCProperties(),this.loadInitalProperties(),this.loadInitialCoords(),this.canvas.clear(),this.drawHeaderGroup(),this.drawContentGroup(),this.drawFooterGroup(),this.wrapCanvas(),this.setFrameSize(),this.renderCanvas()}loadInitalProperties(){this.queryStart=1,this.queryEnd=this.sssDataObj.query_len}loadInitialCoords(){this.startPixels=u.get("startPixels"),this.endPixels=u.get("endPixels"),this.startPixels||this.endPixels||([this.startPixels,this.endPixels]=s.getPixelCoords(this.contentWidth,this.contentLabelWidth,this.marginWidth),u.put("startPixels",this.startPixels),u.put("endPixels",this.endPixels))}loadIPRMCProperties(){if(null!=this.sssDataObj){if(this.uniqueDomainDatabases=u.get("uniqueDomainDatabases"),!this.uniqueDomainDatabases){let t=[];for(const e of this.sssDataObj.hits.slice(0,this.numberHits))t.push(e.hit_acc);this.uniqueDomainDatabases=o.getUniqueIPRMCDomainDatabases(this.iprmcDataObj,t),u.put("uniqueDomainDatabases",this.uniqueDomainDatabases)}for(const t of this.domainDatabaseList)if(!this.uniqueDomainDatabases.includes(o.domainDatabaseNameToString(t))){const e=this.domainDatabaseList.indexOf(t);e>-1&&this.domainDatabaseList.splice(e,1)}}}drawHeaderGroup(){let t,e,i;this.topPadding=2,t=u.get("textHeaderGroup"),t||(t=h.drawHeaderTextGroup(this.sssDataObj,{fontSize:this.fontSize,canvasWidth:this.canvasWidth},this.topPadding),u.put("textHeaderGroup",t)),this.canvas.add(t),this.topPadding+=45,e=u.get("textHeaderLink"),i=u.get("textHeaderLink_textSeqObj"),e||([e,i]=h.drawHeaderLinkText(this.sssDataObj,{fontSize:this.fontSize},this.topPadding),u.put("textHeaderLink",e),u.put("textHeaderLink_textSeqObj",i)),this.canvas.add(e),this.staticCanvas||null!=this.sssDataObj.query_url&&""!==this.sssDataObj.query_url&&(c.mouseOverText(e,i,this.sssDataObj.query_def,this.sssDataObj.query_url,{fontSize:this.fontSize},this),c.mouseDownText(e,this.sssDataObj.query_url,this),c.mouseOutText(e,i,this))}drawContentGroup(){let t;if(this.topPadding+=25,t=u.get("titleText"),t||(t=h.drawContentTitleText({fontSize:this.fontSize+1},this.topPadding),u.put("titleText",t)),this.canvas.add(t),this.sssDataObj.hits.length>0)this.topPadding+=35,this.drawPredictionsGroup(),this.topPadding+=50,this.drawDynamicContentGroup(),this.drawColorScaleGroup();else{this.topPadding+=20;const t=h.drawNoHitsFoundText({fontSize:this.fontSize,contentWidth:this.contentWidth},this.topPadding);this.canvas.add(t)}}drawPredictionsGroup(){let t;t=u.get("pfLabelText"),t||(t=h.drawProteinFeaturesText({fontSize:this.fontSize,scaleLabelWidth:this.scaleLabelWidth-50},this.topPadding),u.put("pfLabelText",t)),this.canvas.add(t),d(this,"Pfam",this.uniqueDomainDatabases,this.topPadding,this.contentLabelLeftWidth+190,{fontSize:this.fontSize,staticCanvas:this.staticCanvas}),d(this,"SUPERFAMILY",this.uniqueDomainDatabases,this.topPadding,this.contentLabelLeftWidth+260,{fontSize:this.fontSize,staticCanvas:this.staticCanvas}),d(this,"SMART",this.uniqueDomainDatabases,this.topPadding,this.contentLabelLeftWidth+390,{fontSize:this.fontSize,staticCanvas:this.staticCanvas}),d(this,"HAMAP",this.uniqueDomainDatabases,this.topPadding,this.contentLabelLeftWidth+480,{fontSize:this.fontSize,staticCanvas:this.staticCanvas}),d(this,"PANTHER",this.uniqueDomainDatabases,this.topPadding,this.contentLabelLeftWidth+570,{fontSize:this.fontSize,staticCanvas:this.staticCanvas}),d(this,"PRODOM",this.uniqueDomainDatabases,this.topPadding,this.contentLabelLeftWidth+680,{fontSize:this.fontSize,staticCanvas:this.staticCanvas}),d(this,"PROSITE profiles",this.uniqueDomainDatabases,this.topPadding,this.contentLabelLeftWidth+770,{fontSize:this.fontSize,staticCanvas:this.staticCanvas}),this.topPadding+=30,d(this,"CDD",this.uniqueDomainDatabases,this.topPadding,this.contentLabelLeftWidth+190,{fontSize:this.fontSize,staticCanvas:this.staticCanvas}),d(this,"CATH-Gene3D",this.uniqueDomainDatabases,this.topPadding,this.contentLabelLeftWidth+260,{fontSize:this.fontSize,staticCanvas:this.staticCanvas}),d(this,"PIRSF",this.uniqueDomainDatabases,this.topPadding,this.contentLabelLeftWidth+390,{fontSize:this.fontSize,staticCanvas:this.staticCanvas}),d(this,"PRINTS",this.uniqueDomainDatabases,this.topPadding,this.contentLabelLeftWidth+480,{fontSize:this.fontSize,staticCanvas:this.staticCanvas}),d(this,"TIGRFAMs",this.uniqueDomainDatabases,this.topPadding,this.contentLabelLeftWidth+570,{fontSize:this.fontSize,staticCanvas:this.staticCanvas}),d(this,"SFLD",this.uniqueDomainDatabases,this.topPadding,this.contentLabelLeftWidth+680,{fontSize:this.fontSize,staticCanvas:this.staticCanvas}),d(this,"PROSITE patterns",this.uniqueDomainDatabases,this.topPadding,this.contentLabelLeftWidth+770,{fontSize:this.fontSize,staticCanvas:this.staticCanvas})}drawDynamicContentGroup(){let t=0;for(const e of this.sssDataObj.hits.slice(0,this.numberHits))e.hit_db.length+e.hit_id.length>t&&(t=e.hit_db.length+e.hit_id.length);let e=Number.MAX_VALUE,i=0,l=Number.MAX_VALUE;for(const t of this.sssDataObj.hits.slice(0,this.numberHits))for(const s of t.hit_hsps)this.colorScheme===r.ColorSchemeEnum.ncbiblast?(s.hsp_bit_score<e&&(e=s.hsp_bit_score),s.hsp_bit_score>i&&(i=s.hsp_bit_score),s.hsp_bit_score<l&&s.hsp_bit_score>0&&(l=s.hsp_bit_score)):(s.hsp_expect<e&&(e=s.hsp_expect),s.hsp_expect>i&&(i=s.hsp_expect),s.hsp_expect<l&&s.hsp_expect>0&&(l=s.hsp_expect));this.colorScheme,r.ColorSchemeEnum.ncbiblast,this.gradientSteps=n.getGradientSteps(e,i,l,this.colorScheme);let d=0;for(const e of this.sssDataObj.hits){if(d++,!(d<=this.numberHits)){let t;t=u.get("supressText"),t||(t=h.drawContentSupressText({fontSize:this.fontSize,contentWidth:this.contentWidth},this.topPadding,this.numberHits),u.put("supressText",t)),t.top=this.topPadding,this.canvas.add(t),this.topPadding+=40;break}{let i,l,d;[l,d,i]=h.drawContentSequenceInfoText(t,e,{fontSize:this.fontSize},this.topPadding),this.canvas.add(l),this.canvas.add(d),this.staticCanvas||(c.mouseOverText(d,i,e.hit_def,e.hit_url,{fontSize:this.fontSize},this),c.mouseDownText(d,e.hit_url,this),c.mouseOutText(d,i,this));const u=h.drawLineTracks({startPixels:this.startPixels,endPixels:this.endPixels},{strokeWidth:1},this.topPadding);this.canvas.add(u),this.topPadding+=5;const b=h.drawContentFooterTextGroup({start:this.queryStart,end:e.hit_len,startPixels:this.startPixels,endPixels:this.endPixels},{fontSize:this.fontSize},this.topPadding);this.canvas.add(b),this.topPadding+=15;let f="white",p=0,g=0;for(const t of e.hit_hsps){"-1"===t.hsp_hit_frame?(p=t.hsp_hit_to,g=t.hsp_hit_from):(p=t.hsp_hit_from,g=t.hsp_hit_to),f=this.colorScheme===r.ColorSchemeEnum.ncbiblast?n.getRgbColorFixed(t.hsp_bit_score,this.gradientSteps,a.ncbiBlastGradient):n.getRgbColorGradient(t.hsp_expect,this.gradientSteps,a.defaultGradient);break}let m=0,S=0;[m,S]=s.getDomainPixelCoords(this.startPixels,this.endPixels,e.hit_len,p,g,this.marginWidth);let x=0,v=this.topPadding-15;if(e.hit_acc in this.iprmcDataObj&&void 0!==this.iprmcDataObj[e.hit_acc].matches)for(const t of this.iprmcDataObj[e.hit_acc].matches){const i=o.domainDatabaseNameToString(this.iprmcDataObj[e.hit_acc].match[t][0].dbname);if(this.domainDatabaseList.includes(i)){this.topPadding+=15,x+=15;let a,r,l,d=h.drawDomainLineTracks({startPixels:this.startPixels,endPixels:this.endPixels},{strokeWidth:1,strokeDashArray:[1,5]},this.topPadding);this.canvas.add(d),d.sendToBack(),[r,l,a]=h.drawContentDomainInfoText(t.split("_")[1]+" ►",{fontSize:this.fontSize},this.topPadding),this.canvas.add(r),this.canvas.add(l);const u=o.getDomainURLbyDatabase(t.split("_")[1],i);this.staticCanvas||(c.mouseOverText(l,a,"",u,{fontSize:this.fontSize},this),c.mouseDownText(l,u,this),c.mouseOutText(l,a,this));for(const i of this.iprmcDataObj[e.hit_acc].match[t]){let t=i.start,a=i.end,o=0,r=0;[o,r]=s.getDomainPixelCoords(this.startPixels,this.endPixels,e.hit_len,t,a,this.marginWidth);const l=h.drawDomains(o,r,this.topPadding+10,n.colorByDatabaseName(i.dbname));this.canvas.add(l),this.staticCanvas||(c.mouseOverDomain(l,o,r,t,a,i,{fontSize:this.fontSize},this),c.mouseOutDomain(l,this))}}}x+=15;const w=h.drawHitTransparentBox(m,S,v,f,x);this.canvas.add(w),w.sendToBack(),this.topPadding+=40}}}drawColorScaleGroup(){const t=h.drawScaleTypeText({fontSize:this.fontSize,scaleLabelWidth:this.scaleLabelWidth},this.topPadding);let e,i,s,n,a,o,l,d,u;this.canvas.add(t),[n,a,e,o,l,i,d,u,s]=h.drawCheckBoxText({colorScheme:this.colorScheme,fontSize:this.fontSize,scaleLabelWidth:this.scaleLabelWidth},this.topPadding),this.canvas.add(n),this.canvas.add(a),this.staticCanvas||(c.mouseOverCheckbox(n,e,this),c.mouseOutCheckbox(n,e,r.ColorSchemeEnum.dynamic,this),c.mouseDownCheckbox(n,r.ColorSchemeEnum.dynamic,this)),this.canvas.add(o),this.canvas.add(l),this.staticCanvas||(c.mouseOverCheckbox(o,i,this),c.mouseOutCheckbox(o,i,r.ColorSchemeEnum.fixed,this),c.mouseDownCheckbox(o,r.ColorSchemeEnum.fixed,this)),this.canvas.add(d),this.canvas.add(u),this.staticCanvas||(c.mouseOverCheckbox(d,s,this),c.mouseOutCheckbox(d,s,r.ColorSchemeEnum.ncbiblast,this),c.mouseDownCheckbox(d,r.ColorSchemeEnum.ncbiblast,this)),this.topPadding+=25;const b=h.drawScaleScoreText({fontSize:this.fontSize,scaleLabelWidth:this.scaleLabelWidth,colorScheme:this.colorScheme},this.topPadding);this.canvas.add(b);const f=h.drawScaleColorGradient({scaleWidth:this.scaleWidth,scaleLabelWidth:this.scaleLabelWidth,colorScheme:this.colorScheme},this.topPadding);if(this.canvas.add(f),this.colorScheme===r.ColorSchemeEnum.ncbiblast){const t=(this.scaleLabelWidth+this.scaleWidth-this.scaleLabelWidth)/5;this.topPadding+=15;const e=h.drawLineAxis6Buckets(this.scaleLabelWidth,this.scaleLabelWidth+t,this.scaleLabelWidth+2*t,this.scaleLabelWidth+3*t,this.scaleLabelWidth+4*t,this.scaleLabelWidth+this.scaleWidth,{strokeWidth:1},this.topPadding);this.canvas.add(e),this.topPadding+=5;const i=h.drawScaleTick5LabelsGroup(this.gradientSteps,t,{fontSize:this.fontSize,scaleWidth:this.scaleWidth,scaleLabelWidth:this.scaleLabelWidth},this.topPadding);this.canvas.add(i)}else{const t=(this.scaleLabelWidth+this.scaleWidth-this.scaleLabelWidth)/4;this.topPadding+=15;const e=h.drawLineAxis5Buckets(this.scaleLabelWidth,this.scaleLabelWidth+t,this.scaleLabelWidth+2*t,this.scaleLabelWidth+3*t,this.scaleLabelWidth+this.scaleWidth,{strokeWidth:1},this.topPadding);this.canvas.add(e),this.topPadding+=5;const i=h.drawScaleTick4LabelsGroup(this.gradientSteps,t,{fontSize:this.fontSize,scaleWidth:this.scaleWidth,scaleLabelWidth:this.scaleLabelWidth},this.topPadding);this.canvas.add(i)}}drawFooterGroup(){let t,e;this.topPadding+=30,[t,e]=h.drawFooterText({fontSize:this.fontSize},this.topPadding),this.canvas.add(t)}wrapCanvas(){if(this.topPadding+=20,this.canvasHeight=this.topPadding,this.canvasWrapperStroke){const t=h.drawCanvasWrapperStroke({canvasWidth:this.canvasWidth,canvasHeight:this.canvasHeight});this.canvas.add(t)}}}e.FunctionalPredictions=b}]);